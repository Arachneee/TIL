### 가상화 기술
- 실제로 존재하는 컴퓨터가 아니지만 마치 존재하는 것처럼 만들어주는 기술
- 한대의 컴퓨터에 가상환경의 여러 컴퓨터를 만들 수 있다.
- 하나의 프로그램이 다른 프로그램에 영향을 주지 않게 한다.
- 하이퍼바이저 가상화 방식(VMware 등)
	- 호스트 OS의 자원을 격리해서 새로운 OS를 실행한다. 논리적으로 OS를 격리한다.
	- 하이퍼바이저가 다른 게스트 OS가 호스트OS 커널을 사용할 수 있도록 바꿔준다.
- 컨테이너 가상화
	- 하이퍼바이저보다 가볍고 빠르다.
	- LXC 기술로 커널 자체기능으로 격리 공간을 만들 수 있다.
	- LXC로 격리된 공간이 컨테이너다.
	- 호스트 OS의 커널을 공유하기 때문에 적은 오버헤드로 빠르게 실행할 수 있다.
	- 호스트 OS와 다른 종류의 OS는 실행할 수 없다. 커널을 공유하기 때문.

### 아키텍처
- 컨테이너 엔진과 컨테이너 런타임으로 구분된다.
	- 컨테이너 런타임 : runc (OCI 표준 구현)
- 클라이언트-서버 모델
- Docker Daemon을 실행하기 위해서는 API로 http 통신을 해야하는데 불편하다.
	- 그래서 Docker CLI로 명령어를 실행할 수 있게 제공한다.

### 이미지와 컨테이너
#### 이미지
- 특정 시점의 파일시스템(디렉터리)를 저장한 압축 파일
- 실행 가능한 소프트웨어 + 실행에 필요한 환경
- 디스크 공간 차이
- 메타데이터
	- env : 소프트웨어가 실행 시 참조할 설정 정보
	- cmd : 컨테이너 실행 시 프로세스 실행 명령어 지정
#### 컨테이너
- 실행 상태의 이미지
- 이미지 1 : N 컨테이너
- 컨테이너로 실행 시 CPU, MEM 등의 리소스 사용
- 컨테이너 간 리소스 격리
- 실행시 이미지를 복사해 격리된 디스크 공간 생성
- 컨테이너 실행 시 프로세스도 함께 실행

##### 컨테이너 라이플 사이클

![[스크린샷 2024-07-13 오전 9.24.32.png]]
- 일시 정지 상태 : CPU X, 메모리 O
- 종료 : CPU X, 메모리 X

### 이미지 레지스트리
- 기능
	- 이미지 공유
	- 이미지 검색
	- 이미지 버전 관리
	- 보안
	- 파이프라인
	- 
- 이미지명 규칙
	- 레지스트리주소/프로젝트명/이미지명:이미지태그
		- 기본값 : (docker.io)/(library)/이미지명/:(latest)

### 이미지 빌드
#### 이미지 레이어
이미지는 레이어로 구분된다.
- 재활용에 유리
- 이전 레이어의 변경사항이 저장
- 중복데이터 최소화
- 빌드 속도 향상
- 저장소 효율화
#### 컨테이너 레이어
- 컨테이너 실행 시 읽기, 쓰기 가능한 새로운 레어어 추가
- 다음 레이어에서 이전 레이어의 특정 파일을 수정 할 때, 해당 파일의 복사복을 만들어서 변경 사항을 적용
	- 불변 레이어
#### 이미지 생성 방법
- 커밋
	- 현재 상태의 컨테이너의 상태를 이미지로 저장
		- 기존 이미지(읽기 전용)에 컨테이너 이미지(읽기 & 쓰기) 추가하여 새로운 이미지를 생성한다.
- 빌드
	- Dockerfile을 통해 이미지를 저장
	- 문법
		- FROM {이미지명} : 베이스 이미지 지정
		- COPY {파일경로} {복사할 경로} : 파일을 레이어에 복사 (새로운 레이어 추가)
		- RUN {명령어} : 명령어 실행 (새로운 레이어 추가)
		- CMD ["명령어"] : 컨테이너 실행 시 명령어 지정
		- WORKDIR {폴더명} : 작업 디렉토리 지정
		- USER {유저명} : 명령을 실행할 사용자 변경
		- EXPOSE {포트번호} : 컨테이너가 사용할 포트를 명시
		- ARG {변수명} {변수값} : 이미지 빌드 시점의 환경 변수 설정(실행 시점에는 적용되지 않는다.)
		- ENV {변수명} {변수값} : 이미지 빌드 및 컨테이너 실행 시점의 환경 변수 설정
		- ENTRYPOINT ["명령어"] : 고정된 명령어 지정
			- 보안적으로 임의의 cmd 실행을 막을 수 있다.
	- Dockerfile 있는 폴더의 파일이 도커 데몬에 전달된다.
		- .dockerignore 로 전달하지 않을 파일을 선택할 수 있다.
	- 어플리케이션 빌드 과정이 필요할 수 있다.
- 멀티 스테이지 빌드
	- 어플리케이션 실행을 위해서는 build된 jar 파일만 있으면 되지만 build를 위한 세팅이 필요하다.
	- 어플리케이션 build를 위한 세팅을 따로 분리하는 기술
	- build를 위한 소스코드, 라이브러리, 실행파일을 제거하여 용량을 줄인다.

### 컨테이너 애플리케이션 구성
#### 클라우드
- 확장성
- 복원력

