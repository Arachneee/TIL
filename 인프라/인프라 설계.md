쇼핑몰 인프라 설계

- 한국 고객을 대상으로 서비스한다.
	- Aws zone을 Seoul로 선택합니다.
- 메인 페이지에는 정해진 규칙에 따라 매 시간마다 상품 20개를 고정으로 보여준다.
	- 메인 페이지는 접근이 가장 많기 때문에 DB까지 조회하면 성능이 느려집니다.
	- 따라서 메인 페이지 상품 20를 캐싱합니다. 캐시 TTL을 1시간으로 설정합니다.
	- 1시간 이후에 상품을 업데이트합니다.
- 카테고리의 이름은 변할 수 있으며, 변하는 경우 모든 사용자에게 적절한 시간 내에 반영되어 보여줘야 한다.
	- 카테고리는 많이 바뀌지 않는 정보이기 때문에 캐싱을 활용할 수 있습니다.
	- 하지만 카테고리 이름이 변경되면 사용자에게 혼동을 줄 수 있기 때문에카테고리 이름이 변경되면 캐시를 초기화합니다.
- 사용자는 상품명 또는 카테고리, 태그를 기준으로 상품을 검색할 수 있다.
	- 카테고리, 태그로 검색 성능을 높이기 위해 인덱스를 설정합니다.
	- 상품명 검색은 전문 검색을 활용합니다.
- 상품의 정보가 변경되면 즉시 또는 적절한 시간 내에 검색과 상품 상세 페이지에 반영되어야 한다.
	- 메시지 큐로 상품 정보를 이벤트 발행하고 검색 시스템은 메시지 큐를 구독합니다.
- 상품 검색, 상세 페이지는 고객이 상품을 탐색하고 주문을 하는 과정에서 매우 중요하므로 빠른 성능이 보장되어야 한다.
	- 검색 엔진을 사용하여 전문 검색을 빠르게 합니다.
- 상품 상세 페이지에서는 고객이 남긴 리뷰 평점을 함께 보여줘야 한다.
	- 리뷰 평점을 매번 계산하면 성능이 느려집니다.
	- 평점을 미리 계산하여 캐싱을 해두고 상품 서비스에서 캐싱된 값을 가져옵니다.
- 주문이 완료되면 고객에게 주문 정보를 이메일로 전달해야 한다.
- 주문이 완료되면 판매자에게 상품이 판매되었음을 알려야 한다. 판매자는 주문 관리 페이지를 통해 상품이 출고되었음을 체크할 수 있어야 한다.
	- 주문이 완료되면 주문 메시지 큐에 주문 정보 이벤트를 발행합니다.
	- 판매자 서비스는 주문 이벤트를 구독합니다.
	- 비동기로 이메일을 발송합니다.
- 판매자에게 상품 판매를 알려주는 시스템의 TPS(초당 처리량)는 50이다.
- 피크타임은 오전 11시 ~ 12시(1시간)이며, 이때 주문의 TPS는 100이다.
	- 주문 TPS가 100인데 상품 판매 알림은 50이므로 메시지 큐를 사용하여 처리 속도를 맞춰준다.
	- 메시지 큐의 사이즈를 보고 판매자 서비스의 스케일 아웃을 진행할 수 있다.
- 1일 주문량은 평균 300만건이며, 하나의 DBMS에서 관리할 수 있는 주문 데이터의 양은 약 10억건이다.
	- 주문량이 많으면 조회 성능이 느려지므로 샤딩을 합니다.
	- 1년 주문량은 약 10억건으로 1년 단위로 샤딩을 합니다.
	- 1년 단위로 샤딩을 해도 데이터 량이 많아 조회 성능이 느립니다.
	- 1일 단위로 파티셔닝을 추가로 진행하여 성능을 높입니다.
- 회원은 2000만명이며, 등록한 셀러는 20만개, 총 상품 수는 10억건이다.
- 전자상거래 등에서의 소비자보호에 관한 법률에 의거하여 고객의 주문 데이터는 5년간 보관되어야 한다.
	- 1년 단위로 샤딩을 진행하여 5년이 지난 데이터는 삭제합니다.