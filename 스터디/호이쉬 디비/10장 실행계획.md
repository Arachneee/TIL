# 통계 정보
## 테이블 및 인덱스 통계 정보
- MySQL은 테이블 데이터를 분석하여 실행계획을 비용기반 최적화를 한다.
- `SELECT * FROM innodb_index_stats`로 테이블의 통계정보를 조회할 수 있다.
	- 인덱스가 가진 유니크한 값의 개수
	- 인덱스의 리프 노드 페이지 개수
	- 인덱스 트리의 전체 페이지 개수
	- 테이블의 전체 레코드 건수
	- 프라이머리 키의 크기(InnoDB 페이지 개수)
	- 프라이머리 키를 제외한 인덱스의 크기(InnoDB 페이지 개수)
- 통계정보는 자동으로 갱신여부를 설정할 수 있다.(영구적으로 통계 정보를 남길 수 있다.)
## 히스토그램
- 칼럼의 데이터 분포를 확인할 수 있다.
- 종류
	- Singleton : 칼럼값 개별로 레코드 건수를 관리하는 히스토그램. 도수분포
	- Equi-Height : 칼럼값의 범위를 균등한 개수로 구분
- 히스토그램이 없으면 데이터의 분포가 균등하다고 예측한다.
- 조건에 일치하는 레코드 건수를 예측하기 위해 B-Tree를 샘플링해서 살펴본다. 
- 조인같은 경우 더 적은 데이터 테이블을 먼저 읽어 조인 횟수를 줄일 수 있다.
## 코스트 모델
- 쿼리에 대해 다양한 작업이 얼마나 필요한지 예측하고 전체 작업 비용을 계산한 결과를 바탕으로 최적의 실행 계획을 찾는다.
- 인덱스를 찾고 레코드를 비교하고 임시 테이블 처리에 대한 비용을 관리하는 테이블 존재
- 레코드를 가진 데이터 페이지를 가져오는데 필요한 비용을 관리하는 테이블 존재
- 단위 작업 비용 표

| 설명                 | default_value | cost_name                    |
| ------------------ | ------------- | ---------------------------- |
| 디스크 데이터 페이지 읽기     | 1             | io_block_read_cost           |
| 메모리 데이터 페이지 읽기     | 0.25          | memory_block_read_cost       |
| ==디스크 임시 테이블 생성==  | ==20==        | dist_temptable_create_cost   |
| 디스크 임시 테이블의 레코드 읽기 | 0.5           | dist_temptable_row_cost      |
| 인덱스 키 비교           | 0.05          | key_compare_cost             |
| 메모리 임시 테이블 생성      | 1             | memory_temptable_create_cost |
| 메모리 임시 테이블의 레코드 읽기 | 0.1           | memory_temptable_row_cost    |
| 레코드 비교             | 0.1           | row_evaluate_cost            |
- 값을 함부로 바꾸지 않는 것이 좋다.
## 실행 계획 확인
- EXPLAIN ANALYZE : 실제로 실행해서 결과 확인
- EXPLAIN : 예측된 실행 계획 확인
- 실행 순서
	- 들여쓰기가 같은 레벨에서는 상단 라인 먼저 실행
	- 들여쓰기가 다른 레벨에서는 가장 안쪽 라인 먼저 실행
- 결과 의미
	- actual time : 실제 소요 시간 (첫번째 수는 첫번째 레코드, 두번째 수는 마지막 레코드)
	- rows : 레코드 건수 (일치하는 평균 레코드 건수)
	- loops: 반복 횟수 (레코드 찾는 작업 반복 횟수)