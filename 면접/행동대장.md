어떻게 유지보수에 좋은 도메인을 설계할 수 있을까?
- 도메인 로직을 서비스 객체에서 도메인 객체로 위임하자.
	- 일급컬렉션 활용하기
	- 생명주기가 같은 객체는 양방향 연관관계, cascade, orphanremoval 활용하기
		- 고아객체에 변경감지가 발생하면 update쿼리가 먼저나간다.
	- 원시값 포장하기
- 생명주기가 전혀 다른 도메인은 의존관계를 끊어주자
	- 외래키 제약 조건을 해제한다.
	- id만 가질 수 있도록한다.
	-> 데이터 정합성은 어떻게 보장할 것인가?
		- 배치프로그램을 돌려 정합성을 보장시킨다.

성능 최적화


인프라
- 무중단 db 마이그레이션
https://medium.com/29cm/api-v2-%EC%A0%84%ED%99%98%EA%B3%BC-db-%EB%AC%B4%EC%A4%91%EB%8B%A8-%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98-%ED%9B%84%EA%B8%B0-8b39eb0db566

	- 상황
		- 기존 ec2 -> rds로 변환 
		- v1, v2의 스키마, 로직 변경이 많음
	- 해결 방안
		- V1서버에서 V2에 호환되도록 API를 변환하여 전송한다.
			- DB 마이그레이션을 진행하는 동안의 딜레이가 있다.
		- V1 DB log를 변환하여 V2 DB에 복제한다.
			- log를 조작하는 학습곡선이 크다.
		- SQS 큐를 사용한다.
			- 서비스 로직를 변환해야하는 공수가 든다.
			- 큐에 쌓이는 동안의 딜레이가 있다. (1초 미만?)
	- 문제 단순화
		- db 이동과 db 마이그레이션을 한번에 하지 말고 따로 하자.
		- 

- 무중단 배포
	- V1 -> V2
		- V1, V2 둘다 호환이 가능한 V1.5 를 전체 배포한다.
			- 이때, 마이그레이션을 바로 진행하는 것이 아닌 테이블이나 컬럼만 추가해서 데이터를 드롭시키지 않는다.
		- V1.5 배포가 완전히 종료된 이후에 마이그레이션을 진행한다.
			- 종료되기 전에 진행하면 마이그레이션이 필요한 데이터가 계속 쌓이는 상태이기 때문이다.
		- V2까지 완전히 배포가 된 이후에 프론트 배포를 하여 V2를 호출 하도록 한다.
	- 블루 - 그린 배포를 사용하면 잠깐 동안이라도 이전 API를 호출하는 문제가 있다.
		- 프론트 정적파일이 바로 배포가 되는 것이 아니기 때문이다.
		- DB 마이그레이션을 진행하는 도중에 V1으로 가면 안되기 때문에 블루 -> 그린 트래픽 전환하기 직전에 마이그레이션을 진행해야한다.
	- -> 롤링 방식을 이용해서 하나씩 순차적으로 배포를 하는 것도 좋다.



- S3 이미지 업로드(9.3MB)
	- Stream
		- ![[Pasted image 20240925141126.png]]
	- MultiPart
		- ![[Pasted image 20240925141323.png]]
	- Stream Async
		- 